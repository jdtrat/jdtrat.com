<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Title</title>
    <meta charset="utf-8" />
    <meta name="author" content="Jonathan Trattner" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <meta name="description" content="A brief introduction for integrating JavaScript with Shiny."/>
    <meta name="generator" content="xaringan and remark.js"/>
    <meta name="twitter:title" content="Shiny + JavaScript"/>
    <meta name="twitter:description" content="A brief introduction for integrating JavaScript with Shiny."/>
    <meta name="twitter:url" content="https://jdtrat.com/talks/shiny-js/slides.html"/>
    <meta name="twitter:image:src" content="https://jdtrat.com/talks/shiny-js/cover.png"/>
    <meta name="twitter:image:alt" content="The title slide for the Shiny + JavaScript talk. It&#39;s a blue background with the title in gold text. Underneath, the author&#39;s name, Jonathan Trattner, and the date originally presented, 3-4-2021, is in white text."/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:creator" content="@jdtrat"/>
    <meta name="twitter:site" content="@jdtrat"/>
    <meta property="og:title" content="Shiny + JavaScript"/>
    <meta property="og:description" content="A brief introduction for integrating JavaScript with Shiny."/>
    <meta property="og:url" content="https://jdtrat.com/talks/shiny-js/slides.html"/>
    <meta property="og:image" content="https://jdtrat.com/talks/shiny-js/cover.png"/>
    <meta property="og:image:alt" content="The title slide for the Shiny + JavaScript talk. It&#39;s a blue background with the title in gold text. Underneath, the author&#39;s name, Jonathan Trattner, and the date originally presented, 3-4-2021, is in white text."/>
    <meta property="og:type" content="website"/>
    <meta property="og:locale" content="en_US"/>
    <meta property="article:author" content="Jonathan David Trattner"/>
    <link rel="stylesheet" href="jdtrat.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: inverse center middle

# Shiny + JavaScript

.large[Jonathan Trattner | 03-04-2021]





---
class: inverse center middle

# Introduction üëã

???
  
Comments can go here!

---
name: theme
layout: true
.my-header[
]

.my-footer[
]

---
class: middle center

.my-header[
.title[
What is {shiny}?
]
]

.inset[
"{shiny} is an R package that makes it easy to build interactive web apps straight from R."&lt;sup&gt;1&lt;/sup&gt;
]

.footnote[
&lt;sup&gt;1&lt;/sup&gt;https://shiny.rstudio.com
]
---
class: middle center

.my-header[
.title[
What is {shiny}?
]
]

.left[
Traditional websites are built using a few different languages:

* HTML for defining the structure of websites
* CSS for customizing the aesthetics of websites
* JavaScript for controlling the behavior of websites
]

--

.question[
{shiny} and related packages&lt;sup&gt;1&lt;/sup&gt; translate R to these languages.
]

.footnote[
&lt;sup&gt;1&lt;/sup&gt; See [{shinythemes}](http://rstudio.github.io/shinythemes/), [{htmlwidgets}](http://www.htmlwidgets.org), and [{shinyjs}](https://deanattali.com/shinyjs/).
]
---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# Steps to Integrate JavaScript

--
1Ô∏è‚É£: What do you want to do? &lt;br&gt;&lt;/br&gt;
2Ô∏è‚É£: Figure out how to do it in JavaScript &lt;br&gt;&lt;/br&gt;
3Ô∏è‚É£: Wrap the JavaScript in `Shiny.addCustomMessageHandler` &lt;br&gt;&lt;/br&gt;
4Ô∏è‚É£: Call the JavaScript function from R &lt;br&gt;&lt;/br&gt;

--

.center[
.inset-glow[
As an example, I will show you how to add a class to an object.
]
]
---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 1Ô∏è‚É£ What do you want to do?
--

* Make text .red[red] when clicking a üîò.

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 1Ô∏è‚É£ What do you want to do?

* Make text .red[red] when clicking a üîò.

# 2Ô∏è‚É£ How can you do it in JS?


```js
// Using Vanilla JavaScript, we can do this:
var element = document.getElementById("element");
element.classList.add("red");
```

???
Because Shiny has JQuery as a dependency, though, we can do this in an easier way!

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 1Ô∏è‚É£ What do you want to do?

* Make text .red[red] when clicking a üîò.

# 2Ô∏è‚É£ How can you do it in JS?


```js
// Using Vanilla JavaScript, we can do this:
*var element = document.getElementById("element");
element.classList.add("red");
```

???
Because Shiny has JQuery as a dependency, though, we can do this in an easier way!

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 1Ô∏è‚É£ What do you want to do?

* Make text .red[red] when clicking a üîò.

# 2Ô∏è‚É£ How can you do it in JS?


```js
// Using Vanilla JavaScript, we can do this:
var element = document.getElementById("element");
*element.classList.add("red");
```

???
Because Shiny has JQuery as a dependency, though, we can do this in an easier way!

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 1Ô∏è‚É£ What do you want to do?

* Make text .red[red] when clicking a üîò.

# 2Ô∏è‚É£ How can you do it in JS?


```js
// Using JQuery, we can do this:
var element = $("#element");
element.addClass("red");
```

???
I think JQuery is nicer to work with, so I'm going to use this second method.


---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 1Ô∏è‚É£ What do you want to do?

* Make text .red[red] when clicking a üîò.

# 2Ô∏è‚É£ How can you do it in JS?


```js
// Using JQuery, we can do this:
*var element = $("#element");
element.addClass("red");
```

???
I think JQuery is nicer to work with, so I'm going to use this second method.

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 1Ô∏è‚É£ What do you want to do?

* Make text .red[red] when clicking a üîò.

# 2Ô∏è‚É£ How can you do it in JS?


```js
// Using JQuery, we can do this:
var element = $("#element"); 
*element.addClass("red");
```

???
I think JQuery is nicer to work with, so I'm going to use this second method.

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# Functionalize our JavaScript

--


```js

function addClass(params) { 
$("#" + params.input_id).addClass(params.class_name);
}

```

--

* Define a function that takes in an object `params`
--

  * `params` will contain an input id and class name
--

* When called, this function will add the specified class to the specified element.

???

We're presumably going to want to add classes to multiple input types, so let's go ahead and convert our addClass statement to a function that takes in the id of the element and the class name.

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 3Ô∏è‚É£ Wrap as Message Handler 


```js
// when JavaScript receives the message "add_class" 
// perform this function
Shiny.addCustomMessageHandler("add_class", function (params) { 
$("#" + params.input_id).addClass(params.class_name);
});
```

???

So our step one was to figure out what we want to do
Step 2 was to do it in JavaScript
Step 3 is to wrap our JavaScript code so Shiny can talk to it.

A JavaScript event handler is a way to trigger certain actions whenever a specific event occurs -- just like Shiny's observeEvent. We can tell it what to look for. In this case, we're going to define a MESSAGE handler, which just means "any time you get a message X, do Y."

So in JavaScript, we have the object "Shiny" which has different methods that we can implement. In this case, we want to add a custom message handler. So what this says is that any time the JavaScript server receives a message "add_class", ewxecute the function addClass.

Shiny.addCustomMessageHandler is basically an event handler (think an observer in Shiny) or a sensor that only responds when activated. In this case, we are setting it to activate when it receives the message "add_class".

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 4Ô∏è‚É£ Call `addClass()` from R

--
* We have our JavaScript message handler üîé
--

  * How do we trigger it?

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 4Ô∏è‚É£ Call `addClass()` from R

* We have our JavaScript message handler üîé
  * How do we trigger it?
  
```{.r}
session$sendCustomMessage()
```

???

Well, we have a message handler looking for messages on the JS side, so it makes sense that we would need to send one! We can use the `sendCustomMessage()` function to do so. But remember that our function took an argument params. Well, can easily create one with R as a list! Let's define a function:

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 4Ô∏è‚É£ Call `addClass()` from R

.instructions[
Recall our `params` object had two items: 
* `input_id`
* `class_name`
]

--

Well, let's define a function that accepts those two values:


```r
add_class &lt;- function(.id, .class) {
  # What should go here?
}
```

???
Exactly! If you said that `sendCustomMessage` should go in that function, you're exactly right! Let's take a look at the full function.


---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 4Ô∏è‚É£ Call `addClass()` from R


```r
add_class &lt;- function(.id, .class) {
  session &lt;- shiny::getDefaultReactiveDomain()
  session$sendCustomMessage(
    "add_class",
    list(input_id = .id,
         class_name = .class)
  )
}
```

???
Walking through this line by line. 

The first line shows the session being assigned as the default reactive domain. That's just a way to avoid passing in the Shiny object explicitly from the server.

The second line is where the magic happens, we are using the reactive session object and saying "let's send a custom message". 
This first argument is the message we want to send, and it should match the customMessageHandler that we defined on the JavaScript side. In our case, it's simply "add_class".

The second argument is what will become our params object -- it's simply a list that contains all of our arguments. In this case, the input_id and the class_name.


---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 4Ô∏è‚É£ Call `addClass()` from R


```r
add_class &lt;- function(.id, .class) {
* session &lt;- shiny::getDefaultReactiveDomain()
  session$sendCustomMessage(
    "add_class",
    list(input_id = .id,
         class_name = .class)
  )
}
```

???
Walking through this line by line. 

The first line shows the session being assigned as the default reactive domain. That's just a way to avoid passing in the Shiny object explicitly from the server.

The second line is where the magic happens, we are using the reactive session object and saying "let's send a custom message". 
This first argument is the message we want to send, and it should match the customMessageHandler that we defined on the JavaScript side. In our case, it's simply "add_class".

The second argument is what will become our params object -- it's simply a list that contains all of our arguments. In this case, the input_id and the class_name.

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 4Ô∏è‚É£ Call `addClass()` from R


```r
add_class &lt;- function(.id, .class) {
  session &lt;- shiny::getDefaultReactiveDomain() 
* session$sendCustomMessage(
    "add_class",
    list(input_id = .id,
         class_name = .class)
  )
}
```

???
Walking through this line by line. 

The first line shows the session being assigned as the default reactive domain. That's just a way to avoid passing in the Shiny object explicitly from the server.

The second line is where the magic happens, we are using the reactive session object and saying "let's send a custom message". 
This first argument is the message we want to send, and it should match the customMessageHandler that we defined on the JavaScript side. In our case, it's simply "add_class".

The second argument is what will become our params object -- it's simply a list that contains all of our arguments. In this case, the input_id and the class_name.

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 4Ô∏è‚É£ Call `addClass()` from R


```r
add_class &lt;- function(.id, .class) {
  session &lt;- shiny::getDefaultReactiveDomain() 
* session$sendCustomMessage(
*   "add_class",
    list(input_id = .id,
         class_name = .class)
  )
}
```

???
Walking through this line by line. 

The first line shows the session being assigned as the default reactive domain. That's just a way to avoid passing in the Shiny object explicitly from the server.

The second line is where the magic happens, we are using the reactive session object and saying "let's send a custom message". 
This first argument is the message we want to send, and it should match the customMessageHandler that we defined on the JavaScript side. In our case, it's simply "add_class".

The second argument is what will become our params object -- it's simply a list that contains all of our arguments. In this case, the input_id and the class_name.

---
class: top

.my-header[
.title[
Integrating JavaScript
]
]

# 4Ô∏è‚É£ Call `addClass()` from R


```r
add_class &lt;- function(.id, .class) {
  session &lt;- shiny::getDefaultReactiveDomain() 
  session$sendCustomMessage(
    "add_class",
*   list(input_id = .id,
*        class_name = .class)
  )
}
```

???
Walking through this line by line. 

The first line shows the session being assigned as the default reactive domain. That's just a way to avoid passing in the Shiny object explicitly from the server.

The second line is where the magic happens, we are using the reactive session object and saying "let's send a custom message". 
This first argument is the message we want to send, and it should match the customMessageHandler that we defined on the JavaScript side. In our case, it's simply "add_class".

The second argument is what will become our params object -- it's simply a list that contains all of our arguments. In this case, the input_id and the class_name.

---
layout: false
class: inverse middle center

# But, does this work?
.large-emoji[ü§î ü§î ü§î]

???
So we've briefly walked through how to connect R and JavaScript. But, does this actually work? Well, let's see.

---
class: top
layout: theme

.my-header[
.title[
Shiny App - Demo
]
]

# User-Interface

&lt;div style = "margin-top: -25px;"&gt;&lt;/div&gt;

```r
ui &lt;- fluidPage(
  # Add one div with id ‚Äúme‚Äù
  div(id = "me", 
      p("Me")),
  # Add another div with id ‚Äúme-again‚Äù
  div(id = "me-again",
      p("Me, again.")
      ),
  actionButton(inputId = "meRed", 
               "Make 'Me' red"),
  actionButton(inputId = "meAgainRed", 
               "Make 'Me, again.' red")
)
```

.my-footer[
]
---
class: top
layout: theme

.my-header[
.title[
Shiny App - Demo
]
]

# Server

&lt;div style = "margin-top: -25px;"&gt;&lt;/div&gt;

```r
server &lt;- function(input, output, session) {
  # When the button meRed is clicked
  # add the red class to the "me" div.
  observeEvent(input$meRed, {
    add_class(.id = "me", .class = "red")
  })
  
  # When the button meAgainRed is clicked
  # add the red class to the "me-again" div.
  observeEvent(input$meAgainRed, {
    add_class(.id = "me-again", .class = "red")
  })
}
```

.my-footer[
]
---
class: top center
layout: theme

.my-header[
.title[
Shiny App - Demo
]
]

# What does this look like?

![:scale 75%](shiny-js-demo.gif)

.footnote[
Code can be [found here](https://gist.github.com/jdtrat/9dcef57687772742e7227cbd373e20aa).
]

.my-footer[
]
---
class: middle
layout: theme

.my-header[
.title[
Thanks üôè üôå
]
]

A special thank you to the wonderful people who helped me on my R/Shiny/JavaScript journey:

* [Lucy D'Agostino McGowan](https://lucymcgowan.com/) (Wake Forest University)
* [Nick Strayer](https://nickstrayer.me/) (RStudio)
* [Maya Gans](https://maya.rbind.io) (Atorus Research)
* [Dean Attali](https://deanattali.com) (AttaliTech)
* [Paul Le Grand](https://www.paullegrand.org)

.my-footer[
]
---
class: inverse center middle

# Questions?

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="my-macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
